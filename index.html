<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA GESTÃƒO - XKmix</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --roxo: #4b2c71; --laranja: #e67e22; --verde: #25D366; }
        body { font-family: sans-serif; background-color: var(--roxo); margin: 0; padding: 15px; color: #333; }
        
        /* CabeÃ§alho com a Foto */
        .header { text-align: center; padding: 10px 0 20px; }
        .logo-container { width: 120px; height: 120px; margin: 0 auto; background: #fff; border-radius: 20px; display: flex; align-items: center; justify-content: center; border: 4px solid var(--laranja); overflow: hidden; }
        .logo-container img { width: 100%; height: 100%; object-fit: contain; }

        .container { max-width: 500px; margin: auto; padding-bottom: 100px; }
        
        /* Estilo dos Cards do Script Original */
        .categoria-card { background: #fff; border-radius: 12px; margin-bottom: 15px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        h2 { color: var(--roxo); font-size: 16px; border-bottom: 2px solid #eee; margin-top: 0; padding-bottom: 8px; text-transform: uppercase; }
        
        .item-row { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #f2f2f2; font-size: 15px; }
        .item-row input { width: 20px; height: 20px; margin-right: 12px; cursor: pointer; }

        /* RodapÃ© Fixo */
        .footer { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--roxo); padding: 15px; border-top: 2px solid var(--laranja); box-sizing: border-box; }
        .btn-whatsapp { background: var(--verde); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; width: 100%; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo-container">
            <img src="https://i.postimg.cc/vBf5rMQc/F3F489B5-7AC2-4DA8-94C8-D819346C6836.png" alt="Logo XKmix">
        </div>
    </div>

    <div class="container" id="lista-itens">
        </div>

    <div class="footer">
        <button class="btn-whatsapp" onclick="enviarPedido()">ðŸš€ ENVIAR PEDIDO VIA WHATSAPP</button>
    </div>

<script>
    // ConfiguraÃ§Ã£o do seu Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAH5egfaSGzr74JGZB-Wzii1VdkC1UiFKk",
        authDomain: "sistema-xkmix.firebaseapp.com",
        projectId: "sistema-xkmix",
        storageBucket: "sistema-xkmix.firebasestorage.app",
        messagingSenderId: "1096205200442",
        appId: "1:1096205200442:web:491c0f7b57bd7599f71903",
        databaseURL: "https://sistema-xkmix-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Itens originais do seu script
    const DADOS = {
        "SORVETES / AÃ‡AÃS": ["Abacaxi", "Abacaxi ao vinho", "AÃ§aÃ­", "AÃ§aÃ­ c/ ninho", "Bananinha", "Base baulinha", "Base ninho", "Blue ice", "Chocolate", "CupuaÃ§u", "Kiwi", "LimÃ£o", "Morango", "Nutella", "Oreo", "Ovomaltine", "PaÃ§oca"],
        "COMPLEMENTOS": ["Amendoim", "Choco ball", "Granola", "Granulado", "Jujuba", "Leite condensado", "MM", "Ovomaltine", "PaÃ§oca"],
        "BEBIDAS": ["Ãgua mineral", "Coca cola 1L", "Coca cola lata", "GuaranÃ¡ lata", "H2O", "Monster"]
    };

    // FunÃ§Ã£o para renderizar a lista
    function renderizar() {
        const container = document.getElementById('lista-itens');
        
        // Busca as marcaÃ§Ãµes no Firebase para mostrar o que jÃ¡ foi marcado
        db.ref('marcados').on('value', (snapshot) => {
            const marcados = snapshot.val() || [];
            container.innerHTML = '';

            for (let categoria in DADOS) {
                let html = `<div class="categoria-card"><h2>${categoria}</h2>`;
                DADOS[categoria].forEach(item => {
                    const isChecked = marcados.includes(item) ? 'checked' : '';
                    html += `
                        <div class="item-row">
                            <input type="checkbox" id="${item}" ${isChecked} onchange="salvarNoFirebase('${item}')">
                            <label for="${item}">${item}</label>
                        </div>`;
                });
                html += `</div>`;
                container.innerHTML += html;
            }
        });
    }

    // Salva ou remove o item do Firebase ao clicar no Checkbox
    function salvarNoFirebase(item) {
        const ref = db.ref('marcados');
        ref.once('value', (snapshot) => {
            let marcados = snapshot.val() || [];
            if (marcados.includes(item)) {
                marcados = marcados.filter(i => i !== item);
            } else {
                marcados.push(item);
            }
            ref.set(marcados);
        });
    }

    // FunÃ§Ã£o original de envio para o WhatsApp
    function enviarPedido() {
        db.ref('marcados').once('value', (snapshot) => {
            const marcados = snapshot.val() || [];
            if (marcados.length === 0) return alert("Marque algum item!");

            let texto = "*ðŸ“¦ NOVO PEDIDO XKMIX*\n\n";
            for (let categoria in DADOS) {
                const selecionados = DADOS[categoria].filter(i => marcados.includes(i));
                if (selecionados.length > 0) {
                    texto += `*${categoria}:*\n`;
                    selecionados.forEach(i => texto += `â€¢ ${i}\n`);
                    texto += `\n`;
                }
            }

            const link = `https://wa.me/5581900000000?text=${encodeURIComponent(texto)}`;
            window.open(link, '_blank');
        });
    }

    // Inicia o sistema
    renderizar();
</script>

</body>
</html>
